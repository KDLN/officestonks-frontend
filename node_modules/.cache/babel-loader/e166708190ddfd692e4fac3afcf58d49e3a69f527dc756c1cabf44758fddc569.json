{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{getAllStocks}from'../services/stock';import{initWebSocket,addListener,closeWebSocket}from'../services/websocket';import Navigation from'../components/Navigation';import'./StockList.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StockList=()=>{const[stocks,setStocks]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[sortBy,setSortBy]=useState('symbol');const[sortDirection,setSortDirection]=useState('asc');// Fetch stocks on component mount\nuseEffect(()=>{const fetchStocks=async()=>{try{const stocksData=await getAllStocks();setStocks(stocksData);setLoading(false);}catch(err){setError('Failed to load stocks. Please try again later.');setLoading(false);}};fetchStocks();// Initialize WebSocket connection\ninitWebSocket();// Listen for stock price updates\nconst removeListener=addListener('stock_update',message=>{setStocks(prevStocks=>prevStocks.map(stock=>stock.id===message.stock_id?{...stock,current_price:message.price,priceChange:stock.current_price<message.price?'up':'down'}:stock));});// Cleanup on unmount\nreturn()=>{removeListener();closeWebSocket();};},[]);// Handle sort change\nconst handleSortChange=field=>{if(sortBy===field){// If already sorting by this field, toggle direction\nsetSortDirection(sortDirection==='asc'?'desc':'asc');}else{// If sorting by a new field, default to ascending\nsetSortBy(field);setSortDirection('asc');}};// Filter and sort stocks\nconst filteredAndSortedStocks=stocks.filter(stock=>stock.symbol.toLowerCase().includes(searchTerm.toLowerCase())||stock.name.toLowerCase().includes(searchTerm.toLowerCase())||stock.sector.toLowerCase().includes(searchTerm.toLowerCase())).sort((a,b)=>{let compareA,compareB;// Determine values to compare based on sort field\nswitch(sortBy){case'price':compareA=a.current_price;compareB=b.current_price;break;case'name':compareA=a.name;compareB=b.name;break;case'sector':compareA=a.sector;compareB=b.sector;break;default:// 'symbol'\ncompareA=a.symbol;compareB=b.symbol;}// Compare values with respect to sort direction\nif(sortDirection==='asc'){return compareA>compareB?1:-1;}else{return compareA<compareB?1:-1;}});if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading stocks...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error});}return/*#__PURE__*/_jsxs(\"div\",{className:\"stock-list-page\",children:[/*#__PURE__*/_jsx(Navigation,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"stock-list-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Available Stocks\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stock-list-controls\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search stocks...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"stock-search\"})}),/*#__PURE__*/_jsxs(\"table\",{className:\"stock-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSortChange('symbol'),children:[\"Symbol \",sortBy==='symbol'&&(sortDirection==='asc'?'▲':'▼')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSortChange('name'),children:[\"Name \",sortBy==='name'&&(sortDirection==='asc'?'▲':'▼')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSortChange('sector'),children:[\"Sector \",sortBy==='sector'&&(sortDirection==='asc'?'▲':'▼')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSortChange('price'),children:[\"Price \",sortBy==='price'&&(sortDirection==='asc'?'▲':'▼')]}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredAndSortedStocks.map(stock=>/*#__PURE__*/_jsxs(\"tr\",{className:stock.priceChange?`price-${stock.priceChange}`:'',children:[/*#__PURE__*/_jsx(\"td\",{children:stock.symbol}),/*#__PURE__*/_jsx(\"td\",{children:stock.name}),/*#__PURE__*/_jsx(\"td\",{children:stock.sector}),/*#__PURE__*/_jsxs(\"td\",{className:\"price-cell\",children:[\"$\",stock.current_price.toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Link,{to:`/stock/${stock.id}`,className:\"trade-button\",children:\"Trade\"})})]},stock.id))})]}),filteredAndSortedStocks.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"no-results\",children:\"No stocks found matching your search.\"})]})]});};export default StockList;","map":{"version":3,"names":["React","useState","useEffect","Link","getAllStocks","initWebSocket","addListener","closeWebSocket","Navigation","jsx","_jsx","jsxs","_jsxs","StockList","stocks","setStocks","loading","setLoading","error","setError","searchTerm","setSearchTerm","sortBy","setSortBy","sortDirection","setSortDirection","fetchStocks","stocksData","err","removeListener","message","prevStocks","map","stock","id","stock_id","current_price","price","priceChange","handleSortChange","field","filteredAndSortedStocks","filter","symbol","toLowerCase","includes","name","sector","sort","a","b","compareA","compareB","className","children","type","placeholder","value","onChange","e","target","onClick","toFixed","to","length"],"sources":["/home/kdln/code/officestonks/frontend/src/pages/StockList.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { getAllStocks } from '../services/stock';\nimport { initWebSocket, addListener, closeWebSocket } from '../services/websocket';\nimport Navigation from '../components/Navigation';\nimport './StockList.css';\n\nconst StockList = () => {\n  const [stocks, setStocks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [sortBy, setSortBy] = useState('symbol');\n  const [sortDirection, setSortDirection] = useState('asc');\n\n  // Fetch stocks on component mount\n  useEffect(() => {\n    const fetchStocks = async () => {\n      try {\n        const stocksData = await getAllStocks();\n        setStocks(stocksData);\n        setLoading(false);\n      } catch (err) {\n        setError('Failed to load stocks. Please try again later.');\n        setLoading(false);\n      }\n    };\n\n    fetchStocks();\n\n    // Initialize WebSocket connection\n    initWebSocket();\n\n    // Listen for stock price updates\n    const removeListener = addListener('stock_update', (message) => {\n      setStocks(prevStocks => \n        prevStocks.map(stock => \n          stock.id === message.stock_id \n            ? { \n                ...stock, \n                current_price: message.price,\n                priceChange: stock.current_price < message.price ? 'up' : 'down'\n              } \n            : stock\n        )\n      );\n    });\n\n    // Cleanup on unmount\n    return () => {\n      removeListener();\n      closeWebSocket();\n    };\n  }, []);\n\n  // Handle sort change\n  const handleSortChange = (field) => {\n    if (sortBy === field) {\n      // If already sorting by this field, toggle direction\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      // If sorting by a new field, default to ascending\n      setSortBy(field);\n      setSortDirection('asc');\n    }\n  };\n\n  // Filter and sort stocks\n  const filteredAndSortedStocks = stocks\n    .filter(stock => \n      stock.symbol.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      stock.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      stock.sector.toLowerCase().includes(searchTerm.toLowerCase())\n    )\n    .sort((a, b) => {\n      let compareA, compareB;\n      \n      // Determine values to compare based on sort field\n      switch (sortBy) {\n        case 'price':\n          compareA = a.current_price;\n          compareB = b.current_price;\n          break;\n        case 'name':\n          compareA = a.name;\n          compareB = b.name;\n          break;\n        case 'sector':\n          compareA = a.sector;\n          compareB = b.sector;\n          break;\n        default: // 'symbol'\n          compareA = a.symbol;\n          compareB = b.symbol;\n      }\n      \n      // Compare values with respect to sort direction\n      if (sortDirection === 'asc') {\n        return compareA > compareB ? 1 : -1;\n      } else {\n        return compareA < compareB ? 1 : -1;\n      }\n    });\n\n  if (loading) {\n    return <div className=\"loading\">Loading stocks...</div>;\n  }\n\n  if (error) {\n    return <div className=\"error\">{error}</div>;\n  }\n\n  return (\n    <div className=\"stock-list-page\">\n      <Navigation />\n      <div className=\"stock-list-container\">\n        <h1>Available Stocks</h1>\n        \n        {/* Search and filter */}\n        <div className=\"stock-list-controls\">\n          <input \n            type=\"text\" \n            placeholder=\"Search stocks...\" \n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"stock-search\"\n          />\n        </div>\n        \n        {/* Stocks table */}\n        <table className=\"stock-table\">\n          <thead>\n            <tr>\n              <th onClick={() => handleSortChange('symbol')}>\n                Symbol {sortBy === 'symbol' && (sortDirection === 'asc' ? '▲' : '▼')}\n              </th>\n              <th onClick={() => handleSortChange('name')}>\n                Name {sortBy === 'name' && (sortDirection === 'asc' ? '▲' : '▼')}\n              </th>\n              <th onClick={() => handleSortChange('sector')}>\n                Sector {sortBy === 'sector' && (sortDirection === 'asc' ? '▲' : '▼')}\n              </th>\n              <th onClick={() => handleSortChange('price')}>\n                Price {sortBy === 'price' && (sortDirection === 'asc' ? '▲' : '▼')}\n              </th>\n              <th>Action</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filteredAndSortedStocks.map(stock => (\n              <tr \n                key={stock.id} \n                className={stock.priceChange ? `price-${stock.priceChange}` : ''}\n              >\n                <td>{stock.symbol}</td>\n                <td>{stock.name}</td>\n                <td>{stock.sector}</td>\n                <td className=\"price-cell\">${stock.current_price.toFixed(2)}</td>\n                <td>\n                  <Link to={`/stock/${stock.id}`} className=\"trade-button\">\n                    Trade\n                  </Link>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n        \n        {filteredAndSortedStocks.length === 0 && (\n          <div className=\"no-results\">No stocks found matching your search.</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default StockList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}