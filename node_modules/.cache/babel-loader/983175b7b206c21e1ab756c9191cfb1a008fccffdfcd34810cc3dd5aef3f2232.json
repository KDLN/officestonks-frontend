{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{getRecentMessages,sendChatMessage}from'../services/chat';import{getUserId}from'../services/auth';import'./Chat.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Chat=()=>{const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[minimized,setMinimized]=useState(false);const messagesEndRef=useRef(null);const currentUserId=parseInt(getUserId());const messageContainerRef=useRef(null);const fetchMessages=async()=>{try{setLoading(true);setError(null);const data=await getRecentMessages(50);setMessages(data);setLoading(false);}catch(err){setError('Failed to load chat messages');setLoading(false);}};useEffect(()=>{fetchMessages();// Set up WebSocket listener for new messages\nconst setupWebSocketListener=()=>{if(window.socket){const removeListener=window.addListener('chat_message',message=>{setMessages(prevMessages=>[...prevMessages,message.data]);});// Clean up on unmount\nreturn removeListener;}return null;};const removeListener=setupWebSocketListener();return()=>{if(removeListener){removeListener();}};},[]);// Scroll to bottom whenever messages change\nuseEffect(()=>{if(messagesEndRef.current&&!minimized){messagesEndRef.current.scrollIntoView({behavior:'smooth'});}},[messages,minimized]);const handleSubmit=async e=>{e.preventDefault();if(!newMessage.trim()){return;}try{await sendChatMessage(newMessage);setNewMessage('');// Note: We don't add the message here because it will come back via WebSocket\n}catch(err){console.error('Failed to send message:',err);// Optionally show an error to the user\n}};const toggleMinimize=()=>{setMinimized(!minimized);};const formatTime=dateString=>{const date=new Date(dateString);return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});};return/*#__PURE__*/_jsxs(\"div\",{className:`chat-container ${minimized?'minimized':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",onClick:toggleMinimize,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Office Stonks Chat\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-toggle-btn\",children:minimized?'▲':'▼'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",ref:messageContainerRef,children:[loading?/*#__PURE__*/_jsx(\"div\",{className:\"chat-status\",children:\"Loading messages...\"}):error?/*#__PURE__*/_jsx(\"div\",{className:\"chat-status\",children:error}):messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-chat\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Be the first to start the conversation!\"})]}):messages.map(msg=>/*#__PURE__*/_jsxs(\"div\",{className:`message ${msg.user_id===currentUserId?'own':'other'}`,children:[msg.user_id!==currentUserId&&/*#__PURE__*/_jsx(\"span\",{className:\"message-user\",children:msg.username}),/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:msg.message}),/*#__PURE__*/_jsx(\"div\",{className:\"message-time\",children:formatTime(msg.created_at)})]},msg.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"chat-input\",value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"Type a message...\",disabled:loading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"chat-send-btn\",disabled:!newMessage.trim()||loading,children:\"\\u27A4\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","getRecentMessages","sendChatMessage","getUserId","jsx","_jsx","jsxs","_jsxs","Chat","messages","setMessages","newMessage","setNewMessage","loading","setLoading","error","setError","minimized","setMinimized","messagesEndRef","currentUserId","parseInt","messageContainerRef","fetchMessages","data","err","setupWebSocketListener","window","socket","removeListener","addListener","message","prevMessages","current","scrollIntoView","behavior","handleSubmit","e","preventDefault","trim","console","toggleMinimize","formatTime","dateString","date","Date","toLocaleTimeString","hour","minute","className","children","onClick","ref","length","map","msg","user_id","username","created_at","id","onSubmit","type","value","onChange","target","placeholder","disabled"],"sources":["/home/kdln/code/officestonks/frontend/src/components/Chat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { getRecentMessages, sendChatMessage } from '../services/chat';\nimport { getUserId } from '../services/auth';\nimport './Chat.css';\n\nconst Chat = () => {\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [minimized, setMinimized] = useState(false);\n  const messagesEndRef = useRef(null);\n  const currentUserId = parseInt(getUserId());\n  const messageContainerRef = useRef(null);\n\n  const fetchMessages = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await getRecentMessages(50);\n      setMessages(data);\n      setLoading(false);\n    } catch (err) {\n      setError('Failed to load chat messages');\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchMessages();\n\n    // Set up WebSocket listener for new messages\n    const setupWebSocketListener = () => {\n      if (window.socket) {\n        const removeListener = window.addListener('chat_message', (message) => {\n          setMessages(prevMessages => [...prevMessages, message.data]);\n        });\n\n        // Clean up on unmount\n        return removeListener;\n      }\n      return null;\n    };\n\n    const removeListener = setupWebSocketListener();\n    \n    return () => {\n      if (removeListener) {\n        removeListener();\n      }\n    };\n  }, []);\n\n  // Scroll to bottom whenever messages change\n  useEffect(() => {\n    if (messagesEndRef.current && !minimized) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [messages, minimized]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!newMessage.trim()) {\n      return;\n    }\n    \n    try {\n      await sendChatMessage(newMessage);\n      setNewMessage('');\n      // Note: We don't add the message here because it will come back via WebSocket\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      // Optionally show an error to the user\n    }\n  };\n\n  const toggleMinimize = () => {\n    setMinimized(!minimized);\n  };\n\n  const formatTime = (dateString) => {\n    const date = new Date(dateString);\n    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  };\n\n  return (\n    <div className={`chat-container ${minimized ? 'minimized' : ''}`}>\n      <div className=\"chat-header\" onClick={toggleMinimize}>\n        <h3>Office Stonks Chat</h3>\n        <button className=\"chat-toggle-btn\">\n          {minimized ? '▲' : '▼'}\n        </button>\n      </div>\n      \n      <div className=\"chat-messages\" ref={messageContainerRef}>\n        {loading ? (\n          <div className=\"chat-status\">Loading messages...</div>\n        ) : error ? (\n          <div className=\"chat-status\">{error}</div>\n        ) : messages.length === 0 ? (\n          <div className=\"empty-chat\">\n            <p>No messages yet</p>\n            <p>Be the first to start the conversation!</p>\n          </div>\n        ) : (\n          messages.map((msg) => (\n            <div \n              key={msg.id} \n              className={`message ${msg.user_id === currentUserId ? 'own' : 'other'}`}\n            >\n              {msg.user_id !== currentUserId && (\n                <span className=\"message-user\">{msg.username}</span>\n              )}\n              <div className=\"message-content\">{msg.message}</div>\n              <div className=\"message-time\">{formatTime(msg.created_at)}</div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n      \n      <form className=\"chat-form\" onSubmit={handleSubmit}>\n        <input\n          type=\"text\"\n          className=\"chat-input\"\n          value={newMessage}\n          onChange={(e) => setNewMessage(e.target.value)}\n          placeholder=\"Type a message...\"\n          disabled={loading}\n        />\n        <button \n          type=\"submit\" \n          className=\"chat-send-btn\"\n          disabled={!newMessage.trim() || loading}\n        >\n          ➤\n        </button>\n      </form>\n    </div>\n  );\n};\n\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}